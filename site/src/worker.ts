const favicon_ico = `AAABAAMAEBAAAAEAIABoBAAANgAAACAgAAABACAAKBEAAJ4EAAAwMAAAAQAgAGgmAADGFQAAKAAAABAAAAAgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP///////////////////////////////+np6v/i4uP//////////////////////729vf+ampr/3Nzc///////////////////////w8fH/zczR/6uqtf98e4f/hION/9fX2v///////////////v+xsbv/19Tr/2xrc//o6Oj/+fn6/8vLzf+qqbD/e3qD/21sdf9gX2f/cHB4/2Zmbv90c3v/09PX/+Tk5P/m5ub/6ejp/7y7xv+Tkp3/rq2v/5iXmv9pZ3H/VVVb/3x7hP+Ego3/goGM/2Niaf92dX7/jYyT/8TEyP/+/v7/8PDw/729vf/n6Of/zMzM///////4+Pj/pqar/3d3gP9zcnv/hYSK/7Gxtf/MzM7/8PDw//7//v/+/v7///////r6+v/Jycn/wMDA/9TU1P/n5+f///////7+/v/X19f/6enp/9nZ2v/Hxsv/wsHJ/769yf+ysMD/j46Z/8PDxv/+/v7///////////////////////////////////7+/6inrf+oprn/rqy//7e1yf+sqrz/sbDC/5CPnv+ko7X/sK67/+Dg4f////////////////////////////n5+f+gnq7/mpim/39+if93doD/X19m/8fF2P+Mipr/ysff/8LA1v/Jx9L////////////////////////////+//7/pqSz/3Nxe/+BgI3/iYiV/4mIlf+9u87/jo2c/8vI4f/Cv9b/u7nF///////////////////////g4OD//v7+/5+eqv9niHX/RItX/1Gtaf9Ms2f/c6WF/5qZqf/Jx97/zsvj/7i1xP//////////////////////zs7O/8DAwP+dnKb/Pp9Z/yqlRf8okT7/MdFW/1+zd/+qqLr/u7jO/87L4/+6uMj//////////////////////+Tk5P/m5ub/ubfA/0WUXf8rsUr/MNBW/yyvSv9Osmf/tLLF/6upvf/Oy+T/srDB///+/v///////////////////////////8nI0f9Heln/NqpT/z+jWv9BkFj/Xohv/7m4zP+xr8P/zsvk/7Syxf////7////////////////////////////Fxcv/m5mp/5aVpP+Yl6b/p6a3/7Syxf+jorT/qKa5/7GvxP+jobD///7+////////////////////////////7e3t/8LCw//Ix87/t7bC/6+tu/+9vML/ycnO/9DQ1/++vsH/5OTk///////////////////////////////////////////////////////+/v7///////////////////////////////////////////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAACAAAABAAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v7+//v7+//+/v7/////////////////////////////////////////////////////////////////////////////////6Onp/76+wv+hoab/6urq///////////////////////////////////////+/v7/lpaW/2BgYP9GRkb/Kior/3d3eP/9/f3////////////////////////////////////////////////////////////29vb/xcbI/7Oyu/+hoLD/sK7A/4+Pmf+6uMb/3d3e///+/////////////////////////////////v+amZ7/nJur/8C+0//c2vD/UFBa/52dnf////////////////////////////////////////////z8/P/Iycr/p6as/5eWov+lo7T/kY+d/0lJT/9WVV7/WFhf/29vd/+Yl6L/6erq/////////////////////////////v7+/8jIyv/Ix9n/4N31/+Dd9f+1ssb/Dg4P/6SkpP///v7//////////////////v7+/9vc3f+5ub3/h4aP/6Shr/+Zl6X/b295/1pZYf9dXWP/dnV//29udv9XV1//cW96/2tqcf+Pj5f/5+fo/////////////////////////////v7+/6uqrv+6uMr/urjM/62rvP+Fg4//MTA1/93d3f//////6enq/769wP9zc3j/iomU/4mIk/9ubnb/UlJZ/0JBR/9oZ2//jYyY/zo5P/9zc3r/aWhw/2Zmbf9ranL/U1JY/4GAiv+koq//xMTF/7/AwP/S0tL/z8/P/8vLy//8/Pz//v7+/9rb2/+jo6n/j46X/4yLkf+zs7X/9vb2/7a1t/9+fYX/l5Wi/2Vjbf9JSU7/PDxA/2hob/+Mi5X/bmx3/5yap/94d4H/hISP/zw8QP9bWmH/ZWVq/2pqcf9YV13/ZmRt/4iHk/+0tLb//v7+//7+/v/+/v7/6+vr/5qamv/W1tb/2NnY/9TV1f+rq6v/29vb////////////0dHR/1pZXf8vLzT/eHaA/2tqcv9lZG3/hYSP/3Vzfv+OjZb/d3V//46MmP9/f4n/mpik/1lYX/+cmqj/bWxz/7Oxuf/ExMn/2Nja//7+/v/////////////////Y2Nj/zMzM/7e3t//5+fn/+Pj4/9PT0//Z2dn//v7+////////////4+Pj/3t6f/+sqrj/cW96/4KCiv99fYf/amlx/3p5gv+KiJP/fX2E/4GAiP97e4D/ubm7/8nKyf/4+Pj//v79//7//v////7//////////////////////+zs7P+2trb/qqqq/8vLy/+ysrL/4eHh/93d3f+zs7P/////////////////9fX1/35+gv9aWmD/kI+a/4SCjf9gX2X/c3N2/56en//Ozs7/+vr5//7+/v/+/v7///////////////////////z8/P/+/v7///////////////////////j4+P/Ozs7/t7e3/8zMzP/S0tL/v7+//+vr6////////////////////////Pz8/8DAwf+dnZ7/zMzM//f39//+/v7//v7+///+///+/v7/+vv7/+Dg4P/Ix8j/sbG0/56eo/+RkJn/dHN9/4GAg//r6+z////+///////////////////////+/v7////////////+/v7////////////////////////////////////////////+/v7/5eXl/8PDxP+lpKf/j4+U/5CPmv+SkJ7/nJmr/7W0yf/KyN//zsrk/8rI3/+Uk6L/tLLE/399iP+kpKb//Pz8/////v///////////////////////////////////////////////////////////////////////////+Pk4/96eob/uLfM/83J4f/Oy+P/zcrh/7u4zv+dm67/kI6e/5eVpP+SkKD/iIeV/2tqdv/KyN7/d3aD/7Wyx/+Eg4z/0tLS///////////////////////////////////////////////////////////////////////+/f3/z8/O/3Rxf/+RkJ//iomX/4aFk/+Yl6f/trTI/87M4P/Jx9v/wcDS/9/d9f/Ny+D/lJOj/3d2g/+ZmKn/zcvj/83L4v+cmqz/iYmN//r6+v///////////////////////////////////////////////////////////+jo6P+HhZL/z83h/9LP5P+1s8X/mJem/5WUof+XlqL/cnF7/1NTWv9hYWj/wsHT/+Dd9P+fna7/goCQ/87L4//Oy+T/zsvk/83L4/+opbn/4uLi/////////////////////////////////////////////////////////////v7+/6Sisf+HhpP/cXB5/29ueP9paHH/Z2Vu/2Zlbf9ubXb/YGBp/2dmbf+ZmKX/4N71/4yLmf+CgJD/zcvj/7680v+hoLD/zcvi/8K/1f/X19j////////////////////////////////////////////////////////////+/v7/j46b/5OSof9vbnX/W1pi/19eZf9YWF7/Wlpg/1BQVv9oaHL/jIuX/7q4y//f3fX/jo6c/5yaqv/Oy+P/xMHZ/52brf/Oy+P/w8DV/6ysrf////////////////////////////////////////////////////////////7//v+6ucT/vLnN/2tqdP+Vk6L/nJus/7Oxxf/Jxtv/s7DD/5eUpP+amKb/ioiU/9DO4/+Yl6b/eHaF/87L5P/Oy+P/zsvk/87L4//IxNz/tLS2/////////////////////////////////////////////////////////////////5aVnf+sq7z/fn2I/5+eqf9wbXX/SEtN/3aMgP9rinb/a4x3/2WgeP82bEL/y8rc/5GPnv+cmqv/zsvj/87L5P/Oy+T/zsvj/8/L5P+2tbn///////////////////////////////////////7+/v/CwsL/wMDA//7+/v/+/v7/tbS7/4eFlP9Va2D/KZtD/yeoRf8xzFX/Ms9W/zHRVv8x0Vb/MNFW/y3ETf+dnKv/q6q6/5KQoP+8us//zsvk/87L5P/Oy+P/z8vj/4uLj/////////////////////////////////////////////39/f/U1NT/mpqa//v8+/+Qj5P/o6Cy/0ZwVv8v0lb/MNFX/ymUPv8lhjf/MrZP/zDSVv8w0Vb/M85V/6Gsr/+lo7T/oZ+x/726z//Oy+T/zsvk/87L4//Oy+P/m5ug///////////////////////////////////////+/v7/v7+//6qqqv+YmJj/0tLS/62tr/+WlqX/U2ph/zDRVv8vyFL/H2gu/yOBNv8miDr/MdFX/zHRVv8z0Vj/c4KA/8jG2/+bmar/kpGh/87L4//Oy+T/zsvj/83L4/+ysbr///7+///////////////////////////////////////+/v7/sbGx/6Ghof/4+Pj/tra3/767zP9hcG//L9FW/zDRV/8w0lb/Mc9W/zHQV/8wx1L/Lr5Q/zLRV/94mof/zcvh/5KPoP+RkKD/zsvk/87L5P/Oy+T/zcvj/4+Ol//+/v7///////////////////////////////////////7+/v/l5eX///////////+4t7j/uLbH/1FQWv8zwFP/GVIk/zLRV/8w0lb/L9FW/yuqR/8ljT7/MdFW/1uLaP/g3fT/k5Gg/4B+jf/Oy+P/zsvk/87L5P/Oy+T/np6n///+/v///////////////////////////////////////////////////////////+Pj4/+6uMv/aWd0/zC5T/8yylb/MdFX/zHRV/8v0lX/NM9Y/zPGVf8vr03/XYlq/9/d9v+WlaT/ioiW/87L4//Oy+T/zsvk/87L5P+wr73////+///////////////////////////////////////////////////////+//7/4+Pj/6Sis/9mZHD/HWQv/ziRT/87fU7/Tn9g/01sWv9KU1T/VFlg/1xaZv+Rj57/3931/5KRoP+gnrH/zsvj/87L5P/Oy+T/zsvk/4SDkP/+/v3////////////////////////////////////////////////////////////8+/v/rau6/6yqu/+FhJH/gYGO/52bq/+Yl6X/rKq8/7Szw//AvtD/vLrM/5iWqP+amaj/Wlpj/5uaqv/Jxtz/zsvk/83L5P/Oy+P/hIKP//79/f////////////////////////////////////////////////////////////39/f9wcHn/o6Gy/5iXpv+VlKP/paOz/4eGk/+Xlqb/iIeX/6Kgs/+0ssb/yMbc/8zK4f/Oy+T/vbrP/4GAkP+Dgo//qKa4/6+uwf+Kio3///7//////////////////////////////////////////////////////////////v7+/7i4uP+Li4z/goGE/5uZpP+SkKH/tbLG/83K4//OyuP/uLXL/6Cerf+Zl6L/n56n/4+Omv+Ylqb/trTE/5aVoP9oZ2r/lZWW//39/f/////////////////////////////////////////////////////////////////////////////////+/v7//v7+//T09P+5ubn/o6Om/5OTmP+jo6f/vLy8//7+/v/+/v7/+fn4//b39v/+//7//f7+//7+/v////7////////////////////////////////////////////////////////////////////////////////////////////////////////////+/v7//v7+//7+/v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/v7//v79//7+/v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/v7/9vf3/+Li4//4+Pj////+//////////////////////////////////////////////////////////////////Hx8f/f39//39/f/8nJyf+srKv/l5eW/8PDw//9/f3//////////////////////////////////////////////////////////////////////////////////////////////////////////////////v7+/+jp6P+trrD/np2l/4aFjf+cm5//8vLy/////////////////////////////////////////////////////////////v7+/5+fn/8hISH/ISEh/xwcHP8cHB7/GRkb/ygpKv++vr///v7+////////////////////////////////////////////////////////////////////////////////////////////+/v7/+zt7f/a2dv/r6+0/4GAjP+2tcf/0tDk/5KSnv+4tcX/u7rD/+zs7f/+/f7//////////////////////////////////////////////////v7+/5+gof9ISE//hoaU/6Gfsv/Oy+D/2Nbq/15dav9JSUn/4eHh/////////////////////////////////////////////////////////////////////////////////+rq6//CwsP/tLO5/7Cvuv+ko7H/p6S1/6Wksv97eob/cXF8/z09Qv93doD/rau6/4qKkP/n5+j////////////////////////////////////////////////////+/83Lz/+9vMv/3930/9/d9f/g3fX/4N31/728z/8pKS3/WFhZ/+Tk5P/+/v7///////////////////////////////////////////////////////39/f/Z2tr/lJWX/46MlP+zsr7/nJqp/359i/+lpLL/cG53/zg4PP8yMjf/VFNd/4SDjf9oZ2//YWFo/5qYpP+xsLf/8fLy/////////////////////////////////////////////v7+//Hx8f+oqK7/09Ll/+Dd9v/g3fX/4N32/9PR6P9aWWT/CQkK/0pKS//k5OX///7+//////////////////////////////////n5+f/o6On/0NDS/4aGi/+Jh5H/trPC/4qHlv95d4P/mJek/5eWov+DgYv/PT1C/3l4gf+Bf4n/ZGNq/1VVX/9xb3r/QUBH/1lYXv+KiZP/n5+j//Ly8f/+/v////////////////////////////////////////7+/v/MzM3/l5af/9DN4v/a2O7/zszh/83L3/+6uMn/X15o/x8fI/9tbWz/9fX1//////////////////v7+//c3Nz/vLy9/6qqrv+FhYz/hIKO/6OisP+WlaH/fn2G/3Jwe/9eXmX/PT1D/0dITv89PUP/T09S/2tqc/94d4H/dHR7/2Zmbf96eYL/fn2G/z8/RP98e4T/oqGu/6enrv/W1tf/8fHx/+fn5//09PT//v7+//7+/v/+/v7//v7+///////+/v7/zs7O/6OiqP+nprL/iomW/6Sjr/+dm6f/fHqF/319hP+Hh4n/9PT1///+///6+fr/y8zL/6moq/9/foP/Y2Nq/318h/+mpbL/iIeR/01NU/87O0H/OjpA/3p5gf9ZWF7/cnF5/5+eq/90c3//MTE2/z8+Q/97eoT/c3J7/1lZXv9lZGz/W1pi/4eFjv9DQ0j/ampz/727y/+XlZ//x8fH/76+v/+srKz/tra2/7Ozs/+ioqL/s7Oz//j4+P///////v7+//X19f/X2Nn/oaKn/35+hf+Af4P/gYGE/8rKy//w8PH//v7+/9/f3/+AgIP/kpGa/4aFkf+Oi5j/kI2a/3Jxef8vLzP/Ly4y/2BgZv+Cgon/bWx0/1hXYP+SkJz/hIOQ/1hXYP++vcr/bGt2/ycnKv9SUlb/WFdf/2tqcf9eXWP/d3eA/0RES/9qaW//TU1R/3V0fv+WlKH/yMjI//79/v/+/v7//v7+//7+/v/4+Pj/0dHR/5GRkf/ExMT/8fHx//Hx8f/x8vH/7e7u/8LCwv+bnJv/5ubm//7+/v///////////9fW1/9vbnP/bm11/2dlb/9TUln/Kywv/zs7Pv9OTVP/g4KL/4+Omv93dYD/hoSQ/4KBi/+CgYv/n52q/359h/+QkJv/a2tz/25td/80NDj/b253/21sdv9hYGj/bW10/4eGjv+IhpH/jYuX/6Oiq/+oqKr/9PT0//7//v//////////////////////4eHh/6ioqP+Wlpb/ysrK/9PU0//T1NP/zs/O/729vv/w8PD//f39//////////////////b29v+ko6T/MjI1/1FRV/9RUVn/op+u/2Jiav91dH3/Tk5V/5uap/9/fYj/WVhh/2JiZ/+ioKz/dXN+/21rdv+korH/ampy/8PBz/9xcHn/enqE/8G+zf+KiJP/d3Z8/56eo//S0tX/5ufp/+7u7//6+vr/////////////////////////////////urq6/+Xl5f+3t7f/1tbW//z8/P/8/Pz/+/v7/7u7u/+xsbH/zMzM//z8/P/////////////////9/f3/tre3/1lYXf+zsb//q6q3/11cZf+mpLL/bm11/39+if9qanP/gH+I/2Ria/9nZm//op+s/4aFj/+dnKf/hIOM/1pbYf+Hhor/lpec/56gn//P0M//9/f2//3+/P/9//7///7+///+/v//////////////////////////////////////y8vL/6mpqf/MzMz/r6+v/+/v7//i4uL/qamp/7m5uf/u7u7/r6+v/5WVlf/4+Pj//////////////////v7+/8HBwf+FhYn/kI6a/21sdP99fIb/YmFq/3Z2f/+Pj5r/bGtz/1NSWf96eIH/eHh+/3d4ev+cnJ7/tbS2/8HBwv/l5eX/+/v7//7//v///////////////////////////////////////////////////////////////////////v7+/9fX1/+1tbX/k5OT/5WVlf+Hh4f/x8fH/+vr6//a2tr/x8fH/6Ghof/29vb///////////////////////39/f/e3t//dHN2/1ZVW/9xcHn/p6Wx/1taYv9tbHX/U1JX/3p5fP+8vLz/3t7e/+zs7P/29vb//v79//////////////////////////////////////////////////z8/P/6+vr///////////////////////////////////////7+/v/19fX/7+/v/+jo6P/S0tL/zs7O/87Ozv/Pz8//5ubm//T09P/////////////////////////////////+//7/+Pj4/5qZmv97e33/XV1f/6Ojo//T09P/9vb2//7+/v/+/v7//v7+///+///+//7//v////39/v/7/Pz/7u/v/+zr7P/m5eb/5ufo/8XGx/+ysrX/d3d6/3p6gP9VVVj/vr6+//T09P///v7////+//////////////////////////////////39/f/+/v7////////////+/v7//v7+//////////////////////////////////////////////////7+/v/+/v7//v7+//7+/v/+/v7///////7+/v/+/v7/+fn5/+Pj4//S0tL/urq8/7Gxs/+fnqL/jIuR/42Mlf+Yl6L/oZ+u/5uZq/+npbn/tLLH/7a0yf9zcn3/fnyI/5GRl//IyMj/+fr5//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7//v/29/f/wMDB/62trv9zc3X/dnV7/2RkbP+JiJT/nZus/7q4yv+5t8r/vrvS/8G/1//LyuH/zMri/87L5P/NyuL/yMXZ/7Wzxv+BgIz/xMHY/5COnP96eYP/j46Q//j4+P///v3////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+//b19f+HiIr/fn2L/5eWqP/KyNz/zcnh/83L4//Oy+P/zsvj/8vI4f/Cvtf/u7jP/7azxv+vrcD/rKu7/3h3hP9zcn7/SEhR/zc3Pv+IiJb/zMvf/0ZFT//Gw9j/i4mY/11dYf/Pz9D/+Pf4//////////////////////////////////////////////////////////////////////////////////////////////////////////////////X19f+Tk5f/u7nP/83L4v/Bv9b/u7nO/5SSpP+WlaT/iIeW/6WktP+Qj57/k5Ki/4iIl/+korT/uLbK/83L4f/X1ev/wr/S/35+iv/Cwdf/l5Wl/0NCS//Hxdz/zsvj/7m2y/+FhJH/l5eb/8nJyf/5+fn//////////////////////////////////////////////////////////////////////////////////////////////////Pz7/+Hh4P9vbnL/aGVz/19faf9tbXj/iIeT/6Gfrv+6ucv/xsTZ/9LP5v/U0en/2dfr/87M3/+nprX/srDA/+Dc9P/f3fX/wr/T/29vev+trMD/ZmVu/6Khsv/MyuL/zsvk/87L4//Ixt3/tLHG/3t6hf+hoqL//Pz8///////////////////////////////////////////////////////////////////////////////////////+/v7/y8zM/1ZWXf+hn67/0tDj/9rX7P/W0+n/0c7k/8XD2P/DwdP/trXE/5qZpf94d4D/SklR/1RUW/97eoX/Tk9V/7e1xf/f3fX/4Nz0/5SToP+rqL3/fnuK/87K5P/Oy+T/zsvk/87L5P/Oy+P/zcvk/7260f+Xl53/9fX1///////////////////////////////////////////////////////////////////////////////////////+/v7/9vb2/4+Nmf/e2/P/mZem/6Sisv+Mi5f/iIeR/0pJUf9mZm7/VlZd/4GAif+Mipb/hISN/19faP9cW2P/YGFm/5SSoP/g3fT/4N70/2Jhbf+npbj/fnuK/87L4//Oy+P/zsvj/8PB1//NyuL/zczj/8nF3v+5uML/9fX1/////////////////////////////////////////////////////////////////////////////////////////////f39/29ud//c2e//UVFY/1pZYP9xcHr/bWx2/4qJk/9paHL/Y2Jq/09PVf9zcnz/bW11/2JibP9eXmT/UlJY/1tbYv/e2/H/4N71/29uev+npbf/fnuK/83K4v/Oy+P/o6K1/4aFk/+yscP/zcvj/8rG3v+sq7X/7+/w/////////////////////////////////////////////////////////////////////////////////////////////f39/1lYX//d2vH/U1Jd/2dmbP93dn7/SEdP/3V0fP9NTFT/cXF3/2JiZv9dXWT/Q0NJ/1RUXP9oZm//dnZ9/3p5iP/e2/H/4N31/5GQn/+sqrz/h4WU/83L4v/Oy+P/uLfN/3p5hv+rqbz/zsvj/8rH3v+Ih5L/4uPj/////////////////////////////////////////////////////////////////////////////////////////////v7+/4WFi//g3fT/dXN+/0ZHSv9fXWX/SEdO/1FSWP9ZWWH/dXV//4+Nnf+bman/nJmp/6Kgsf/EwdT/vrzP/83K3//Fw9b/3dvz/4eHlP+dm6z/aGhz/87L5P/Ny+P/ycbe/8rI3//Oy+T/zsvj/8rH3/+Ih5L/4+Pk/////////////////////////////////////////////////////////////////////////////////////////////v7+/6iprf/U0ub/xsPY/5yaqv+pp7n/xMLW/8XD2P/PzeT/0c7k/9LP5f+fna3/j42c/1ZVX/9/fYn/cW95/4iGkf+Mi5b/2dfu/8G/0P+jobL/Q0JM/8/M4//Oy+T/zsvk/87L5P/Oy+T/zsvj/83K4v+fnav/6Ojp/////////////////////////////////////////////////////////////////////////////////////////////v///5aYmv+5t8v/tbXF/6KhsP+wr77/i4yW/2Riav9lZWz/TkxT/5GVmf+Pl5f/mqOi/5ympf+ntbP/fpCH/1BhVf9yeHr/2dbt/8LA1P+PjZ3/cnF+/8/M4//Oy+T/zsvk/87L5P/Oy+T/zsvj/87L5P+npbX/5+fo//////////////////////////////////////////////////////////////////X19f/19fX//v7+/////////////////6ipq/+3tMf/UVBY/1VUXv9VY1v/Zo1z/0JtTv9FhFb/OohN/z+eVv88rFb/KJlC/yaWQP8qqUj/KrdN/yuySf9YlWj/0c/k/8TC1v+RkJ//fXuI/7+90//Oy+T/zsvk/87L5P/Oy+T/zsvj/87L5P+Oi5v/0NDR/////////////////////////////////////////////////////////////v7+/8zMzP9ubm7/urq6//39/f///////v7+/9PT1f+3tcf/UVFb/2Fna/8umUT/LsJR/y3CT/8ty1L/Mc9W/zPPV/8x0Vb/MtBX/zDSVf8x0Vb/L9JV/y/MVP9CiVH/ycbd/8/N4v+iobH/bWt4/7Cvwf/Oy+T/zsvk/87L5P/Oy+T/zsvj/87L5P+Bf47/xsbH/////////////////////////////////////////////////////////////v7+//7+/v/x8fH/nZ2d/2lpaf/ExMT//f7+/8rJy/+PjZz/f3+N/1djZf8tqUr/L9JW/y/SVv8zy1T/Jok5/yJyMP8qlEH/Ms1V/y/SVv8v0lb/L9FW/zHQVv9Kn17/ysvd/8vK3v+HhZT/lZSk/7Kwwf/Oy+T/zsvk/87L5P/Oy+T/zsvk/87L5P+GhZP/yMjJ//////////////////////////////////////////////////////////////////Dw8P/V1dX/xMTE/5qamv+8vLz//P38/8rLy/+PjZv/amhz/2Zzdv8toUj/L9JW/y/QVf8nmUH/JHIy/zXRVf8eYSr/Koo//zHRV/8v0lb/MdFW/zHSVf87mFD/vsLQ/9HQ5P+Zl6b/r63C/5COnP/Oy+T/zsvk/87L5P/Oy+T/zsvi/87L4/+npbj/09PW/////v///v///////////////////////////////////////////////////v7+/7CwsP+vr6//xMTE/9TU1P+UlJT/5OXl/+Xl5v+vrbr/Z2Zy/3N6gv8niz//L9JW/y/PVf8rpUf/GVwm/x1iKv8khjj/LrxN/zHRVv8y0Vf/MNFW/y/SV/8ngjr/srTC/9fV7P+Qjp3/p6S5/2pqdP/Ny+P/zsvj/87L5P/Oy+T/zsvk/83L4/+tq7//xMTH///+//////////////////////////////////////////////////////////////7+/v/39/f/0dHR/29vb/+5ubn/+vv7/+jo5/+rqbX/sK6+/3Z6hf8ukEf/L9JW/y/SVv8u0lb/MdJW/zLKVv8w0Vf/MtBX/zHRVf8wyFP/MM5W/zLRV/8nkD3/sbnB/9fX7P+DgY//ubbM/359iv/Ny+L/zszj/87L4//Oy+T/zsvk/83L4/+rqb7/k5OW///+///+//7////////////////////////////////////////////////////////////U1NT/lpaW/+Xl5f/+/v7//v/+/+Pj4v+Rj5n/sK6+/2dodP9Ckln/Mc9W/yieQ/8wulD/L9JV/zHRV/8w0Vf/MNFV/zDDUP8cZiv/LrNO/zDRVv8srUj/mqqp/97a8v+bmqr/vbvQ/01MV//Ixdz/zsvk/87L5P/Oy+T/zsvk/83L4/+rqb7/k5OW///+/v/////////////////////////////////////////////////////////////////39/f/+fn5/////////////////+np6f+ioar/r62+/1ZUX/87fE//N8lX/w04FP8niz7/MtFX/zDSVv8v0lb/L9FW/zDIVf8nkj3/L79R/zDRVv8rrEb/fY2I/+De8/+Vk6P/tbPF/19dav/HxNr/zsvj/87L5P/Oy+T/zsvk/87L5P/AvtT/oaKn///+/v///v////////////////////////////////////////////////////////////////////////////////////////b19v/Av8j/yMba/2lodP9OiWP/MctT/zTFV/8yy1f/MdJV/zHRVv8v0lb/L9JV/zLRVv8y0Vj/MctW/y/GU/8tqkf/f5GK/9/d9v+WlKX/tLLF/4mGlf+0ssX/zsvk/87L5P/Oy+T/zsvk/87L5P/Ny+L/p6eu//////////7///////////////////////////////////////////////////////////////////////////////////////X19f+dnKL/zcvh/1BPWv9Se2L/MMJR/zDQVv8xxlP/McNT/zG6Uf8nmkH/MKBK/y2GQv81h0n/SYhd/0p4Wv9TemP/io+W/9/d9f+4tsr/r62+/4WElP+opbj/zsvk/87L5P/Oy+T/zsvk/87L5P/NyuL/cnF5//7+/v////7//////////////////////////////////////////////////////////////////////////////////v/+//X19f+YmJz/zMnf/29uef83QkD/G1Uo/zhvSP9BXk7/Q1lQ/2h7d/9lb3P/Y29w/2Nkb/9mZ3T/SUpU/0hGUP9vb3v/op+t/97d9v+6ucz/hYSR/7u5zv+3tMv/zcvj/87L5P/Oy+T/zsvk/87L5P/Ny+L/VFNa//39/f////7///////////////////////////////////////////////////////////////////////////////////////79/f+8u8D/0M3i/6imtv99for/YV9q/19eaf96eob/Xl1p/1paZP+GhZL/iIWU/4uLmP/Avs//x8bZ/8jG2v/Ny9//yMTc/8jH2f+YlqT/ZWRu/7a0x//Hxdz/zMri/87L5P/Oy+T/zcvk/87L4//OyuL/VFNb//39/P///v////////////////////////////////////////////////////////////////////////////////////////7+/v+ko6b/xMLU/93a8v/Kx9z/xMHV/7+9z//Lydv/z83g/6altP+qqbn/mZio/4WEkv+dnKz/jYuZ/5KQoP+hn7D/h4WU/5SSov+PjJ7/iIaX/4eGlP+GhZP/h4aV/7680P/MyeD/zcvj/83L4/+xrsH/Xl5j//7+/f///v////////////////////////////////////////////////////////////////////////////////////////7+/v+SkpP/ioqW/5KRn/9WVV//dXWA/3d2gv9vbnn/oJ6v/5mYp/+op7j/uLfK/7Oyxv+9u9L/vrvT/8G+1P/MyeD/y8nh/8zK4//Oy+T/zcrk/8rH3/+9us//p6W5/2Zncf9gX2v/p6a2/726zv9qanL/y8zM///+///////////////////////////////////////////////////////////////////////////////////////////////////V1dX/c3Nz/0xMTf9YWVr/bm10/6yot/+9us3/urfN/8PA1v/LyeD/zcrk/87L4//Oy+P/wr/V/7u5zP/BvtD/qae3/6imtv+urbz/tbTF/7m3y//Ewdb/x8PZ/7a0xv+GhY//UU9U/0tLTf++vr///v7+///////////////////////////////////////////////////////////////////////////////////////////////////////+/v7//v79//r6+f/g4OD/0dHR/7OztP+zs7b/nZ2h/4qJkP+Qjpr/nZur/5uZq/+bmqv/gH+L/1dXWv+zs7X/s7O0/7i4uP/Gx8f/np6g/52dof/Dw8b/zs7R/7/Bwv+wsLD/wcHB/+jo5//+/v7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7////9/f3/+/v7/+vr6//h4eL/ubm7/6+vsf+vr7H/zs7Q/+Hh4f/4+Pf//v7///////////7//Pz8//v7+//+/v7///////7//////v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v7+//7+/v/+/v7//v7+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==`;

function return_html_index(headlines_ul: string, sources_ul: string, hours: number): string {
    return `<html>
<head>
    <title>Newsfeed | aaronsdevera.com</title>
    <meta name="description" content="Personal news feed curated from several sources." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <style>
        :root {
        --max-width: 1100px;
        --border-radius: 12px;
        --font-mono: ui-monospace, Menlo, Monaco, 'Cascadia Mono', 'Segoe UI Mono',
          'Roboto Mono', 'Oxygen Mono', 'Ubuntu Monospace', 'Source Code Pro',
          'Fira Mono', 'Droid Sans Mono', 'Courier New', monospace;
        --font-family: 'Arial', 'Helvetica', 'sans-serif';
        --foreground-rgb: 0, 0, 0;
        --background-rgb: 255, 255, 255;
        --foreground-rgb-dark: 255, 255, 255;
        --background-rgb-dark: 0, 0, 0;
      }
      
      @media (prefers-color-scheme: dark) {
        :root {
          --foreground-rgb: 0, 0, 0;
          --background-rgb: 255, 255, 255;
        }
      }
      
      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
      }
      
      html,
      body {
        max-width: 100vw;
        overflow-x: hidden;
        font-family: var(--font-family);
      }
      
      body {
        background: rgb(var(--background-rgb));
        color: rgb(var(--foreground-rgb));
      }
      
      a {
        color: rgb(var(--foreground-rgb));
        text-decoration: none;
      }
      
      @media (prefers-color-scheme: dark) {
        html {
          color-scheme: dark;
        }
      }
      
      
      a:hover {
        background-color: #000000;
        color:#ffffff;
      }
      
      
      .header {
        padding: 0px;
        text-align: left;
        margin-top:0px;
        margin-bottom: 50px;
      }
      
      .headerItem {
        display: inline-block;
        padding: 0px 2.5px 15px 2.5px;
      }
      
      .site-title {
        background: #0000ff;
        color:#ffffff;
        padding:5px;
      }
      
      .site-title:hover{
        background: #0000aa;
      }
      
      .site-time {
        background: #ff0000;
        color:#ffffff;
        padding:5px;
      }
      
      .site-mode {
        background: rgb(var(--background-rgb-dark));
        color:#ffffff;
        padding:5px;
      }
      
      .site-tag {
        padding:5px;
      }
      
      .site-tag input {
        border:none;
        width:160px;
        font-weight: bold;
      }
      
      .site-tag input::placeholder {
        color: #afafaf;
      }
      
      .site-tag input:focus{
        outline: none;
      }
      
      .tag-highlight {
        background: #0000ff;
        color:#ffffff;
      }
      
      #highlight-results{
        padding:0px 4px 0px 4px;
      }
      
      .feed ul {
        list-style: none;
        padding:0px;
      }
      
      .feed-item  {
        padding-top: 3px;
        padding-bottom: 3px;
      }
      
      
      /*
      .feed-tag  {
        font-size:8px;
        background: #cccccc;
        margin-left:4px;
      }
      */
      
      .feed-tag  {
        margin: 3px;
        padding: 2px;
        margin-top: 3px;
      }
      
      .tag-highlight {
        background: #0000ff;
        color:#ffffff;
      }
      
      .feed-item-sourcename {
        font-size:8px;
        background: #0000ff;
        color:#ffffff;
      }
      
      .feed-item-sourcetype {
        font-size:8px;
        background: #0000ff;
        color:#ffffff;
      }
      
      .feed-item-createdat {
        font-size:8px;
        background: #cccccc;
      }
      
      
      .tag-highlight {
        background: #ff0000;
        color:#ffffff;
      }
      
      #highlight-results{
        background:#000000;
        color:#aaaaaa;
        padding:0px 4px 0px 4px;
      }
      
      footer {
        margin-top: 0px;
        margin-bottom:50px;
        padding: 10px;
        text-align: center;
        font-size: 12px;
        color: #aaaaaa;
      }
      
      .light-mode-text {
        color: rgb(var(--foreground-rgb));
      }
      
      .dark-mode-text {
        color: rgb(var(--foreground-rgb-dark));
      }
      
      .light-mode-background {
        background: rgb(var(--background-rgb));
      }
      
      .dark-mode-background {
        background: rgb(var(--background-rgb-dark));
      }

      .main {
        top:0px;
        margin-top: 0px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding: 6rem;
        min-height: 100vh;
      }
      
      .description {
        display: inherit;
        justify-content: inherit;
        align-items: inherit;
        font-size: 0.85rem;
        max-width: var(--max-width);
        width: 100%;
        z-index: 2;
        font-family: var(--font-mono);
      }
      
      .description a {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
      }
      
      .description p {
        position: relative;
        margin: 0;
        padding: 1rem;
        background-color: rgba(var(--callout-rgb), 0.5);
        border: 1px solid rgba(var(--callout-border-rgb), 0.3);
        border-radius: var(--border-radius);
      }
      
      .code {
        font-weight: 700;
        font-family: var(--font-mono);
      }
      
      .grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(25%, auto));
        width: var(--max-width);
        max-width: 100%;
      }
      
      .card {
        padding: 1rem 1.2rem;
        border-radius: var(--border-radius);
        background: rgba(var(--card-rgb), 0);
        border: 1px solid rgba(var(--card-border-rgb), 0);
        transition: background 200ms, border 200ms;
      }
      
      .card span {
        display: inline-block;
        transition: transform 200ms;
      }
      
      .card h2 {
        font-weight: 600;
        margin-bottom: 0.7rem;
      }
      
      .card p {
        margin: 0;
        opacity: 0.6;
        font-size: 0.9rem;
        line-height: 1.5;
        max-width: 30ch;
      }
      
      .center {
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        padding: 4rem 0;
      }
      
      .center::before {
        background: var(--secondary-glow);
        border-radius: 50%;
        width: 480px;
        height: 360px;
        margin-left: -400px;
      }
      
      .center::after {
        background: var(--primary-glow);
        width: 240px;
        height: 180px;
        z-index: -1;
      }
      
      .center::before,
      .center::after {
        content: '';
        left: 50%;
        position: absolute;
        filter: blur(45px);
        transform: translateZ(0);
      }
      
      .logo,
      .thirteen {
        position: relative;
      }

      #sources-ul {
        display: inline-block;
        zoom: 1;
      }
      
      #sources-ul li {
        font-size: 12px;
      }

      #feed-ul {
        display: inline-block;
      }
      
      /* Enable hover only on non-touch devices */
      @media (hover: hover) and (pointer: fine) {
        .card:hover {
          background: rgba(var(--card-rgb), 0.1);
          border: 1px solid rgba(var(--card-border-rgb), 0.15);
        }
      
        .card:hover span {
          transform: translateX(4px);
        }
      }
      
      @media (prefers-reduced-motion) {
        .thirteen::before {
          animation: none;
        }
      
        .card:hover span {
          transform: none;
        }
      }
      
      /* Mobile */
      @media (max-width: 700px) {
        .content {
          padding: 4rem;
        }
      
        .grid {
          grid-template-columns: 1fr;
          margin-bottom: 120px;
          max-width: 320px;
          text-align: center;
        }
      
        .card {
          padding: 1rem 2.5rem;
        }
      
        .card h2 {
          margin-bottom: 0.5rem;
        }
      
        .center {
          padding: 8rem 0 6rem;
        }
      
        .center::before {
          transform: none;
          height: 300px;
        }
      
        .description {
          font-size: 0.8rem;
        }
      
        .description a {
          padding: 1rem;
        }
      
        .description p,
        .description div {
          display: flex;
          justify-content: center;
          position: fixed;
          width: 100%;
        }
      
        .description p {
          align-items: center;
          inset: 0 0 auto;
          padding: 2rem 1rem 1.4rem;
          border-radius: 0;
          border: none;
          border-bottom: 1px solid rgba(var(--callout-border-rgb), 0.25);
          background: linear-gradient(
            to bottom,
            rgba(var(--background-start-rgb), 1),
            rgba(var(--callout-rgb), 0.5)
          );
          background-clip: padding-box;
          backdrop-filter: blur(24px);
        }
      
        .description div {
          align-items: flex-end;
          pointer-events: none;
          inset: auto 0 0;
          padding: 2rem;
          height: 200px;
          background: linear-gradient(
            to bottom,
            transparent 0%,
            rgb(var(--background-end-rgb)) 40%
          );
          z-index: 1;
        }
      }
      
      /* Tablet and Smaller Desktop */
      @media (min-width: 701px) and (max-width: 1120px) {
        .grid {
          grid-template-columns: repeat(2, 50%);
        }
      }
      
      @media (prefers-color-scheme: dark) {
        .vercelLogo {
          filter: invert(1);
        }
      
        .logo,
        .thirteen img {
          filter: invert(1) drop-shadow(0 0 0.3rem #ffffff70);
        }
      }
      
      @keyframes rotate {
        from {
          transform: rotate(360deg);
        }
        to {
          transform: rotate(0deg);
        }
      }
      
      </style>
</head>
<body>
    <div id="main" class="main">
        <div class="header">
          <div class="headerItem">
            <a href="https://github.com/aaronsdevera/Personal-News-Feed"><h3><span class="site-title">NewsFeed</span></h3></a>
          </div>
          <div class="headerItem">
            <h3><span id="insert-time" class="site-time"></span></h3>
          </div>
          <div class="headerItem">
            <h3><span id="insert-mode" class="site-mode">toggle dark</span></h3>
          </div>
          <div class="headerItem">
            <h3><span id="insert-tag" class="site-tag dark-mode-text dark-mode-background"><input id="site-tag-input" class="dark-mode-background" placeholder="insert a term to highlight"></input><span id="highlight-results" class="light-mode-text dark-mode-background"></span></span></h3>
          </div>
        </div>

        <div class="feed">
            <ul id="sources-ul">Sources in past ${hours} hours</ul>
            <p>
            <br></br>
            </p>
            <ul id="feed-ul"></ul>
        </div>
      </div>
    <script>const headlines=${headlines_ul}</script>
    <script>const sources=${sources_ul}</script>
    <script>
    headlines.map((entry) => (
        document.getElementById('feed-ul').innerHTML += '<li class=feed-item key=' + entry.id + '><a class="feed-item-headline" href="' + entry.url + '">' + entry.headline.replace("â€™","'") + '</a><span class="feed-tag feed-item-sourcename">' + entry.source_name + '</span><span class="feed-tag feed-item-sourcetype">' + entry.source_type + '</span><span class="feed-tag feed-item-createdat light-mode-text">' + entry.created_at + '</span></li>'
    ));
    </script>
    <script>
    sources.map((source) => (
      document.getElementById('sources-ul').innerHTML += '<li class="source-item"><a class="source-item-name" href="/?source_name=' + source.source_name + '">' + source.source_name +'</a><span class="feed-tag feed-item-sourcetype">' + source.source_type + '</span><span class="feed-tag feed-item-createdat light-mode-text">' + source.volume + '</span></li>'
    ));
    </script>
    <script>
    let MODE=0;document.getElementById("insert-time").innerHTML = new Date().toISOString();
    
document.getElementById('site-tag-input').addEventListener('keyup', (event) => {
    var count = 0;
    const highlighted = document.querySelectorAll('.tag-highlight');
    highlighted.forEach((list_item) => {
        list_item.classList.remove('tag-highlight');
    })
  
    const currentValue = document.getElementById('site-tag-input').value;
    const elements = document.querySelectorAll('.feed li a')
    elements.forEach((list_item) => {
        if (String(list_item.innerHTML).toLowerCase().includes(currentValue.toLowerCase())) {
            list_item.classList.add('tag-highlight')
            count += 1
            document.getElementById('highlight-results').innerHTML = (count.toString() + ' results')
        }
    })
    if (document.getElementById('site-tag-input').value === ''){
        const highlighted = document.querySelectorAll('.tag-highlight');
        highlighted.forEach((list_item) => {
            list_item.classList.remove('tag-highlight');
        })
        document.getElementById('highlight-results').innerHTML = '';
    }
});const switchMode = function(mode) {
  if(!mode) {
    document.getElementById('insert-mode').classList.remove("dark-mode-text");
    document.getElementById('insert-mode').classList.remove("dark-mode-background");
    document.body.classList.remove("light-mode-text");
    document.body.classList.remove("light-mode-background");
    document.getElementById('insert-tag').classList.remove("dark-mode-background");
    document.getElementById('site-tag-input').classList.remove("dark-mode-background");
    document.getElementById('highlight-results').classList.remove("dark-mode-text");
    document.getElementById('highlight-results').classList.remove("dark-mode-background");

    var headlineItems = document.getElementsByClassName('feed-item-headline');
    for (let i = 0; i < headlineItems.length; i++) {
      headlineItems[i].classList.remove("light-mode-text");
    }

    document.getElementById('insert-mode').classList.add("light-mode-text");
    document.getElementById('insert-mode').classList.add("light-mode-background");
    document.body.classList.add("dark-mode-text");
    document.body.classList.add("dark-mode-background");
    document.getElementById('insert-tag').classList.add("light-mode-background");
    document.getElementById('highlight-results').classList.add("light-mode-text");
    document.getElementById('highlight-results').classList.add("light-mode-background");
    document.getElementById('site-tag-input').classList.add("light-mode-text");
    document.getElementById('site-tag-input').classList.add("light-mode-background");

    document.getElementById('insert-tag').classList.add("light-mode-background");
    for (let i = 0; i < headlineItems.length; i++) {
      headlineItems[i].classList.add("dark-mode-text");
    }

    mode = 1;
  }
  else if (mode) {
    document.getElementById('insert-mode').classList.remove("light-mode-text");
    document.getElementById('insert-mode').classList.remove("light-mode-background");
    document.body.classList.remove("dark-mode-text");
    document.body.classList.remove("dark-mode-background");
    document.getElementById('insert-tag').classList.remove("light-mode-background");
    document.getElementById('highlight-results').classList.remove("light-mode-text");
    document.getElementById('highlight-results').classList.remove("light-mode-background");
    document.getElementById('site-tag-input').classList.remove("light-mode-text");
    document.getElementById('site-tag-input').classList.remove("light-mode-background");

    document.getElementById('insert-tag').classList.add("light-mode-background");
    
    var headlineItems = document.getElementsByClassName('feed-item-headline');
    for (let i = 0; i < headlineItems.length; i++) {
      headlineItems[i].classList.remove("dark-mode-text");
    }


    document.getElementById('insert-mode').classList.add("dark-mode-text");
    document.getElementById('insert-mode').classList.add("dark-mode-background");
    document.body.classList.add("light-mode-text");
    document.body.classList.add("light-mode-background");
    document.getElementById('insert-tag').classList.add("dark-mode-background");
    document.getElementById('site-tag-input').classList.add("dark-mode-background");
    document.getElementById('highlight-results').classList.add("dark-mode-text");
    document.getElementById('highlight-results').classList.add("dark-mode-background");

    var headlineItems = document.getElementsByClassName('feed-item-headline');
    for (let i = 0; i < headlineItems.length; i++) {
      headlineItems[i].classList.add("light-mode-text");
    }

    mode = 0;
  }
  return mode
};
document.getElementById('insert-mode').addEventListener('click', (event) => {MODE = switchMode(MODE);});
</script>
<noscript><img src="https://s.onsitejs.org/hdrVxDZ/image.gif" style="display:none;"/></noscript><script src="https://s.onsitejs.org/hdrVxDZ/script.js"></script>
<footer><center><a href="https://web.archive.org/web/20230313014147/https://github.com/aaronsdevera/Personal-News-Feed">(haphazardly) designed by Aaron DeVera. GNU-AGPLv3</a></center></footer>
</body>
</html>`
}

async function do_md5(s: string): Promise<string> {
    const msgUint8 = new TextEncoder().encode(s) // encode as (utf-8) Uint8Array
    const hashBuffer = await crypto.subtle.digest('MD5', msgUint8) // hash the message
    const hashArray = Array.from(new Uint8Array(hashBuffer)) // convert buffer to byte array
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('') // convert bytes to hex string
    return hashHex;
}

async function do_sha256(s :string): Promise<string> {
    const msgUint8 = new TextEncoder().encode(s);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const digest = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    return digest;
}

async function gen_uid(): Promise<string> {
    const uuid = crypto.randomUUID();
    return await do_md5(uuid);
}

async function gen_session(): Promise<string> {
    const uuid1 = await gen_uid();
    const uuid2 = await gen_uid();
    return `${uuid1}${uuid2}`;
}

function gen_ts(): Number {
    //return Math.trunc((Date.now())/1000);
    return Date.now()/1000;
}

function gen_dt_from_ts(ts: any): Date {
    return new Date(ts*1000);
}

async function search(env: Env, auth_headers: Object, query: string = '*', size: number = 500): Promise<any> {
    const url = `${env.DATA_SINK_URL}/search/newsfeed-headlines`;
    
    const body = {
        sort: [
            { "created_at" : {"order" : "desc", "format": "date"}},
            { "ingested_at" : {"order" : "desc", "format": "date"}}
        ],
        query: {
            query_string: {
                query: query
            }
        },
        size: size
    }
    
    const resp = await fetch(url, {
        method: 'POST',
        headers: auth_headers,
        body: JSON.stringify(body)
    });
    
    
    const json = await resp.json();
    
    return json;
}


async function sql(env: Env, auth_headers: Object, query: string = '', size: number = 500): Promise<any> {
  const url = `${env.DATA_SINK_URL}/sql`;
  
  const body = {query: query}
  
  const resp = await fetch(url, {
      method: 'POST',
      headers: auth_headers,
      body: JSON.stringify(body)
  });
  
  
  const json = await resp.json();
  
  return json;
}

async function get_headlines(env: Env, auth_headers: Object, source_name: string = '', source_type: string = '', size: number = 250, hours: number = 24): Promise<Array> {
    let resp: Promise<any>;
    if (source_name !== '' && source_type === '') {
        resp = await search(env, auth_headers, `(created_at:>now-${hours}h) AND source_name:"${source_name}"`, size/2);
    }
    else if (source_name === '' && source_type !== '') {
        resp = await search(env, auth_headers, `(created_at:>now-${hours}h) AND source_type:"${source_type}"`, size-50);
    }
    else {
        resp = await search(env, auth_headers, `(created_at:>now-${hours}h)`, size);
    }
    const hits = resp.hits.hits;
    const headlines = [];
    for (const hit of hits) {
        headlines.push(hit._source);
    }
    return headlines;
}

async function get_sources(env: Env, auth_headers: Object, hours: number = 24): Promise<Array> {
    const resp = await sql(env, auth_headers, `select source_name, source_type, count(*) volume from "newsfeed-headlines" where created_at > now() - interval ${hours} hour group by 1,2 order by volume desc`);
    
    const rows = resp.rows;
    const sources = [];
    for (const row of rows) {
        sources.push({'source_name': row[0], 'source_type': row[1], 'volume': row[2]});
    }
    return sources;
}

export default {
	async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
        const url = new URL(request.url);
        const path = url.pathname;

        const default_hours = 24;


        let auth_headers = {};
        auth_headers[env.AUTH_HEADER_ONE_KEY] = env.AUTH_HEADER_ONE_VALUE;
        auth_headers[env.AUTH_HEADER_TWO_KEY] = env.AUTH_HEADER_TWO_VALUE;

        const sources = await get_sources(env, auth_headers, default_hours);

        if (url.searchParams.get('source_name') !== null) {
            const source_name = url.searchParams.get('source_name');
            const headlines = await get_headlines(env, auth_headers, source_name, '', hours=default_hours);
            return new Response(
                return_html_index(JSON.stringify(headlines), JSON.stringify(sources), default_hours),
                {
                    status: 200,
                    headers: {
                        'content-type': 'text/html',
                    }
                }
            );
        }

        if (url.searchParams.get('source_type') !== null) {
          const source_type = url.searchParams.get('source_type');
          const headlines = await get_headlines(env, auth_headers,'',source_type);
          return new Response(
            return_html_index(JSON.stringify(headlines), JSON.stringify(sources), default_hours),
              {
                  status: 200,
                  headers: {
                      'content-type': 'text/html',
                  }
              }
          );
      }

        if (path.startsWith('/favicon.ico')) {
          return new Response(Uint8Array.from(atob(favicon_ico), c => c.charCodeAt(0)), {
            status: 200,
            headers: {
              "Content-Type": "image/x-icon"
            }
        })
      }

      if (path === '/') {
        const headlines = await get_headlines(env, auth_headers);
                    
        return new Response(
          return_html_index(JSON.stringify(headlines), JSON.stringify(sources), default_hours),
            {
                status: 200,
                headers: {
                    'content-type': 'text/html',
                }
            }
        );
      }

        return new Response(null,{status: 200});
	},
};